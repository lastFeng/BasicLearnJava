### 线程安全与共享资源

#### 线程安全

- 允许被多个线程同时执行的代码称作线程安全代码。
- 线程安全代码不包含竞态条件。
- 当多个线程同时更新共享资源时会发生竞态条件

#### 局部变量
- 局部变量存储在线程自己的栈中。也就是说，局部变量永远也不会被多线程共享
- 基础类型的局部变量时线程安全的

#### 局部的对象引用
- 对象的局部引用尽管本身没有被共享，但是引用所指的对象并没有村村在线程的栈内。
- 所有的对象都是存在共享堆中
- 只要别的线程获取不到该对象，那就是线程安全的

#### 对象成员
- 对象成员存储在堆上
- 如果两个线程同时更新同一个对象的同一个成员，那这个代码就不是线程安全的

#### 线程控制逃逸规则
- 线程控制逃逸规则可以帮助你判断代码中对某些资源的访问是否是线程安全的
```text
   如果一个资源的创建，使用，销毁都在同一个线程内完成的
   且永远不会脱离该线程的控制，则该资源的使用就是线程安全的
```
- 资源可以是对象、数组、文件、数据库连接、套接字等等
- 即使对象本身线程安全，但如果该对象中包含其他资源（文件、数据库连接），
整个应用也许就不再是线程安全的了